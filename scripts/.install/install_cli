#!/bin/bash

USERNAME=$1

# Ensure running as root
if [[ $UID -ne 0 ]]; then echo "$0 requires root."; exit 1; fi

cd /var/lufoodwatch/cli

# Compile binary (this is required so the setuid bit works)
mkdir bin
gcc binary.c -o bin/lufoodwatchserver

# Set script owner
chown $USERNAME:$USERNAME /var/lufoodwatch/cli/bin/lufoodwatchserver
# Set script permissions (owner [read/exec] + group/other [-nothing-])
chmod 500 /var/lufoodwatch/cli/bin/lufoodwatchserver

# Set binary owner
chown $USERNAME:$USERNAME /var/lufoodwatch/cli/bin/lufoodwatchserver
# Set binary permissions (setuid + owner [read/write/exec] + group/other [read/write])
chmod 4755 /var/lufoodwatch/cli/bin/lufoodwatchserver

# Create symlink
ln -s /var/lufoodwatch/cli/bin/lufoodwatchserver /usr/local/bin/lufoodwatchserver